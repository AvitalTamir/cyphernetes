# Cyphernetes

[![Go Report Card](https://goreportcard.com/badge/github.com/avitaltamir/cyphernetes)](https://goreportcard.com/report/github.com/avitaltamir/cyphernetes)
[![Go Reference](https://pkg.go.dev/badge/github.com/avitaltamir/cyphernetes.svg)](https://pkg.go.dev/github.com/avitaltamir/cyphernetes)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

Cyphernetes turns this: ðŸ˜£
```bash
# List all services exposing pods with the 'nginx' app label
kubectl get pods -l app=nginx -o json | \
jq -r '.items[].metadata.labels | to_entries[] | "\(.key)=\(.value)"' | \
xargs -I {} kubectl get services -l {} -o json | \
jq '.items[].metadata.name' | \
xargs kubectl get services
```

Into this: ðŸ¤© 
```graphql
> MATCH (p:Pod {app: "nginx"})<-(s:Service)
RETURN s
```

## But how?

Cyphernetes is [Cypher](https://neo4j.com/developer/cypher/) repurposed for working with the Kubernetes API. A mixture of ascii-art, SQL-esque keywords and jsonPaths, Cyphernetes lets us express Kubernetes CRUD operations in an efficeint, creative and fun way:

```graphql
> MATCH (d:Deployment)
  RETURN d.metadata.name AS name, 
       d.spec.replicas AS desiredReplicas, 
       d.status.availableReplicas AS runningReplicas

{
  "d": [
    {
      "desiredReplicas": 2,
      "name": "coredns",
      "runningReplicas": 2
    }
  ]
}

Query executed in 9.081292ms

```

Cyphernetes' superpower is that it understands the relationships between Kubernetes resource kinds.
This feature lets us express highly complex operations in a natural way, and without having to worry about the underlying Kubernetes API:

```graphql
# similar to `kubectl expose`
MATCH (d:Deployment {name: "nginx")
CREATE (d)->(s:Service)
```

Beyond the fun factor, Cyphernetes aims to be efficient in expressing complex operations.
The more complicated an operation is, the shorter it's Cyphernetes representation would be compared to the equiavalent nested kubectl commands or API client code.

For more usage examples, please see the [Usage Guide](https://github.com/AvitalTamir/cyphernetes/blob/main/USAGE.md).

## Get Cyphernetes

Build using go:

```bash
go install github.com/avitaltamir/cyphernetes/cmd/cyphernetes@latest
```

Alternatively, grab a binary from the [Releases page](https://github.com/AvitalTamir/cyphernetes/releases).

## Development

Cyphernetes is written in Go and utilizes a parser generated by goyacc to interpret the custom query language.

### Prerequisites

* Go (1.16 or later)
* goyacc (for generating the parser)
* Make (for running make commands)

### Getting Started

To get started with development:

Clone the repository:

```bash
git clone https://github.com/avitaltamir/cyphernetes.git
```

Navigate to the project directory:

```bash
cd cyphernetes
```

### Building the Project

Use the Makefile commands to build the project:

* Build & Test:

```bash
make
```

* To build the binary:

```bash
make build
```

* To run tests:

```bash
make test
```

* To generate the grammar parser:

```bash
make gen-parser
```

* To clean up the build:

```bash
make clean
```

### Contributing

Contributions are welcome! Please feel free to submit pull requests, open issues, and provide feedback.

## License

Cyphernetes is open-sourced under the MIT license. See the [LICENSE](LICENSE) file for details.

## Acknowledgments

* Thanks to the [Neo4j](https://neo4j.com/) community for the inspiration behind the query language.

## Authors

* _Initial work_ - [Avital Tamir](https://github.com/avitaltamir)
