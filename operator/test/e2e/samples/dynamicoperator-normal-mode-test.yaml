apiVersion: cyphernetes-operator.cyphernet.es/v1
kind: DynamicOperator
metadata:
  name: normal-mode-test-operator
  namespace: default
spec:
  resourceKind: deployments
  namespace: default
  dryRun: false  # This is the default value, but explicitly setting it for clarity
  onUpdate: |
    MATCH (d:Deployment {name: "{{$.metadata.name}}"})
    WHERE d.spec.replicas > 0
    CREATE (d)->(s:Service {
      "metadata": {
        "name": "auto-service-{{$.metadata.name}}",
        "labels": {
          "created-by": "cyphernetes-normal-mode"
        }
      },
      "spec": {
        "selector": {
          "app": "{{$.metadata.labels.app}}"
        },
        "ports": [
          {
            "port": 80,
            "targetPort": 8080
          }
        ]
      }
    });